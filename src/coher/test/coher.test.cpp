#define CATCH_CONFIG_MAIN
#include <iostream>
#include "catch.hpp"
#include "coher/coher.h"
#include "generalTools/testing.h"
#include <range/v3/all.hpp>


TEST_CASE( "coher" ){

  int iel = 1, npr = 1, maxb = 60000;
  std::vector<double> b ( maxb, 0.0 );
  double emax = 5.0;

  GIVEN( "graphite is the requested material" ){
    iel = 1;
    WHEN( "1 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
	coher( iel, npr, maxb, b, emax );
	std::vector<double> braggVals{4.5558147E-4, 0.0000000000, 1.8223259E-3, 
          1.3693406E-2, 4.1002333E-3, 0.0000000000, 4.5158347E-3, 1.6310105E-3, 
          4.9714162E-3, 9.3268924E-3, 6.3381606E-3, 2.7534307E-3, 7.2893036E-3, 
          6.8467029E-3, 8.6160680E-3, 7.0847164E-3, 1.1389537E-2, 0.0000000000, 
          1.1805138E-2, 2.0175311E-3, 1.3547504E-2, 1.5066630E-2, 1.4003086E-2, 
          2.122138E-28, 1.5369830E-2, 2.8290539E-2, 1.5905372E-2, 5.2144093E-3, 
          1.6400933E-2, 4.5644686E-3, 1.7647737E-2, 1.890345E-28, 1.8063339E-2, 
          8.1550525E-4, 1.8518920E-2, 4.8324703E-3, 1.9885665E-2, 1.5544821E-3, 
          2.0836808E-2, 2.4297420E-2, 2.0916768E-2, 1.5156834E-3, 2.2163572E-2, 
          4.4173026E-3, 2.2323492E-2, 0.0000000000, 2.4937041E-2, 1.590241E-28, 
          2.5352642E-2, 1.3767154E-3, 2.6839327E-2, 4.0141280E-3, 2.9157214E-2, 
          3.4233515E-3, 2.9452876E-2, 3.8318912E-3, 2.9948437E-2, 2.0266963E-2, 
          3.1610843E-2, 1.2329281E-3, 3.2066424E-2, 7.3448301E-3, 3.3433169E-2, 
          2.3977119E-3, 3.3673049E-2, 1.1945781E-3, 3.4464272E-2, 1.1807861E-3, 
          3.5711076E-2, 6.9599409E-3, 3.5870996E-2, 1.325909E-28, 3.6902099E-2, 
          0.0000000000, 3.8900147E-2, 2.2228500E-3, 4.0386831E-2, 3.2723303E-3, 
          4.0642512E-2, 8.6987227E-3, 4.1098094E-2, 3.716174E-28, 4.1417934E-2, 
          3.2313411E-3, 4.2464838E-2, 1.7020057E-2, 4.2704718E-2, 1.6972188E-2, 
          4.3000380E-2, 6.3426519E-3, 4.4742746E-2, 3.561603E-28, 4.5558147E-2, 
          2.7386812E-3, 4.7220553E-2, 1.0087655E-3, 4.7931816E-2, 1.6020048E-2, 
          4.8011776E-2, 2.0008378E-3 };
        checkVec(b,braggVals,braggVals.size());
      } // THEN
    } // WHEN
    WHEN( "3 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
        npr = 3;
	coher( iel, npr, maxb, b, emax );
        std::vector<double> braggVals{4.5558147E-4, 0.0000000000, 1.8223259E-3, 
          4.5644686E-3, 4.1002333E-3, 0.0000000000, 4.5158347E-3, 5.4367017E-4, 
          4.9714162E-3, 3.1089641E-3, 6.3381606E-3, 9.1781024E-4, 7.2893036E-3, 
          2.2822343E-3, 8.6160680E-3, 2.3615721E-3, 1.1389537E-2, 0.0000000000, 
          1.1805138E-2, 6.7251036E-4, 1.3547504E-2, 5.0222099E-3, 1.4003086E-2, 
          7.073795E-29, 1.5369830E-2, 9.4301797E-3, 1.5905372E-2, 1.7381364E-3, 
          1.6400933E-2, 1.5214895E-3, 1.7647737E-2, 6.301150E-29, 1.8063339E-2, 
          2.7183508E-4, 1.8518920E-2, 1.6108234E-3, 1.9885665E-2, 5.1816069E-4, 
          2.0836808E-2, 8.0991400E-3, 2.0916768E-2, 5.0522779E-4, 2.2163572E-2, 
          1.4724342E-3, 2.2323492E-2, 0.0000000000, 2.4937041E-2, 5.300806E-29, 
          2.5352642E-2, 4.5890512E-4, 2.6839327E-2, 1.3380427E-3, 2.9157214E-2, 
          1.1411172E-3, 2.9452876E-2, 1.2772971E-3, 2.9948437E-2, 6.7556543E-3, 
          3.1610843E-2, 4.1097602E-4, 3.2066424E-2, 2.4482767E-3, 3.3433169E-2, 
          7.9923730E-4, 3.3673049E-2, 3.9819270E-4, 3.4464272E-2, 3.9359535E-4, 
          3.5711076E-2, 2.3199803E-3, 3.5870996E-2, 4.419698E-29, 3.6902099E-2, 
          0.0000000000, 3.8900147E-2, 7.4094999E-4, 4.0386831E-2, 1.0907768E-3, 
          4.0642512E-2, 2.8995742E-3, 4.1098094E-2, 1.238724E-28, 4.1417934E-2, 
          1.0771137E-3, 4.2464838E-2, 5.6733524E-3, 4.2704718E-2, 5.6573959E-3, 
          4.3000380E-2, 2.1142173E-3, 4.4742746E-2, 1.187201E-28, 4.5558147E-2, 
          9.1289372E-4, 4.7220553E-2, 3.3625518E-4, 4.7931816E-2, 5.3400160E-3, 
          3.8011776E-2, 6.6694593E-4 };
        checkVec(b,braggVals,braggVals.size());
      } // THEN
    } // WHEN
  } // GIVEN



  GIVEN( "beryllium oxide is the requested material" ){
    iel = 3;
    WHEN( "1 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
	//coher( iel, npr, maxb, b, emax );
	//std::vector<double> bVals { 
        //for ( auto i = 0; i < bVals.size(); ++i ){ equal( b[i], bVals[i] ); }
	//std::cout << b[0] << "    " << b[1] << "     " << b[2] << std::endl;
      } // THEN
    } // WHEN
    WHEN( "3 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
        npr = 3;
	//coher( iel, npr, maxb, b, emax );
        //std::vector<double> bVals { 
       // for ( auto i = 0; i < bVals.size(); ++i ){ equal( b[i], bVals[i] ); }
      } // THEN
    } // WHEN
  } // GIVEN

    /*

  GIVEN( "aluminum is the requested material" ){
    iel = 4;
    WHEN( "1 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 3.759017E-3, 5.508125E-3, 5.012023E-3, 
          3.577632E-3, 1.002404E-2, 5.059536E-3, 1.378306E-2, 8.629574E-3, 
          1.503607E-2, 2.754062E-3, 2.004809E-2, 1.788816E-3, 2.380711E-2, 
          6.566121E-3, 2.506011E-2, 6.399863E-3, 3.007214E-2, 5.842249E-3, 
          3.383116E-2, 7.344167E-3, 4.009619E-2, 2.529768E-3, 4.385520E-2, 
          9.675684E-3, 4.510821E-2, 5.962720E-3, 5.012023E-2, 4.525386E-3, 
          5.387925E-2, 4.364670E-3, 5.513226E-2, 4.314787E-3, 6.014428E-2, 
          1.377031E-3, 6.390330E-2, 8.015499E-3, 6.515631E-2, 3.969026E-3, 
          7.016833E-2, 7.649299E-3 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
    WHEN( "3 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
        npr = 3;
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 3.759017E-3, 1.836041E-3, 5.012023E-3, 
          1.192544E-3, 1.002404E-2, 1.686512E-3, 1.378306E-2, 2.876524E-3, 
          1.503607E-2, 9.180209E-4, 2.004809E-2, 5.962720E-4, 2.380711E-2, 
          2.188707E-3, 2.506011E-2, 2.133287E-3, 3.007214E-2, 1.947416E-3, 
          3.383116E-2, 2.448055E-3, 4.009619E-2, 8.432560E-4, 4.385520E-2, 
          3.225228E-3, 4.510821E-2, 1.987573E-3, 5.012023E-2, 1.508462E-3, 
          5.387925E-2, 1.454890E-3, 5.513226E-2, 1.438262E-3, 6.014428E-2, 
          4.590104E-4, 6.390330E-2, 2.671833E-3, 6.515631E-2, 1.323008E-3, 
          7.016833E-2, 2.549766E-3 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
  } // GIVEN



  GIVEN( "lead is the requested material" ){
    iel = 5;
    WHEN( "1 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 2.514103E-3, 2.464174E-3, 3.352138E-3, 
          1.600528E-3, 6.704277E-3, 2.263488E-3, 9.218381E-3, 3.860619E-3, 
          1.005641E-2, 1.232087E-3, 1.340855E-2, 8.002641E-4, 1.592265E-2, 
          2.937491E-3, 1.676069E-2, 2.863112E-3, 2.011283E-2, 2.613651E-3, 
          2.262693E-2, 3.285566E-3, 2.681710E-2, 1.131744E-3, 2.933121E-2, 
          4.328618E-3, 3.016924E-2, 2.667547E-3, 3.352138E-2, 2.024525E-3, 
          3.603549E-2, 1.952626E-3, 3.687352E-2, 1.930309E-3, 4.022566E-2, 
          6.160436E-4, 4.273976E-2, 3.585900E-3, 4.357780E-2, 1.775626E-3, 
          4.692994E-2, 3.422073E-3 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
    WHEN( "5 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
        npr = 5;
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 2.514103E-3, 4.928349E-4, 3.352138E-3, 
          3.201056E-4, 6.704277E-3, 4.526977E-4, 9.218381E-3, 7.721239E-4, 
          1.005641E-2, 2.464174E-4, 1.340855E-2, 1.600528E-4, 1.592265E-2, 
          5.874982E-4, 1.676069E-2, 5.726224E-4, 2.011283E-2, 5.227303E-4, 
          2.262693E-2, 6.571132E-4, 2.681710E-2, 2.263488E-4, 2.933121E-2, 
          8.657237E-4, 3.016924E-2, 5.335094E-4, 3.352138E-2, 4.049051E-4, 
          3.603549E-2, 3.905252E-4, 3.687352E-2, 3.860619E-4, 4.022566E-2, 
          1.232087E-4, 4.273976E-2, 7.171801E-4, 4.357780E-2, 3.551253E-4, 
          4.692994E-2, 6.844146E-4 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
  } // GIVEN

  GIVEN( "iron is the requested material" ){
    iel = 6;
    WHEN( "1 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 5.000504E-3, 8.711438E-2, 1.000100E-2, 
          3.079958E-2, 1.500151E-2, 0.100591032, 2.000201E-2, 4.355719E-2, 
          2.500252E-2, 7.791747E-2, 3.000302E-2, 2.370953E-2, 3.500353E-2, 
          0.131704577, 4.000403E-2, 1.539979E-2, 4.500453E-2, 8.711438E-2, 
          5.000504E-2, 5.509597E-2, 5.500554E-2, 5.253195E-2, 6.000605E-2, 
          5.029551E-2, 6.500655E-2, 0.144967107, 7.500756E-2, 8.997135E-2, 
          8.000806E-2, 2.177859E-2, 8.500857E-2, 8.451337E-2, 9.000907E-2, 
          5.133264E-2, 9.500958E-2, 0.119912469, 0.100010086, 3.895873E-2, 
          0.105010591, 7.603967E-2 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
    WHEN( "5 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
        npr = 5;
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 5.000504E-3, 1.742287E-2, 1.000100E-2, 
          6.159917E-3, 1.500151E-2, 2.011820E-2, 2.000201E-2, 8.711438E-3, 
          2.500252E-2, 1.558349E-2, 3.000302E-2, 4.741906E-3, 3.500353E-2, 
          2.634091E-2, 4.000403E-2, 3.079958E-3, 4.500453E-2, 1.742287E-2, 
          5.000504E-2, 1.101919E-2, 5.500554E-2, 1.050639E-2, 6.000605E-2, 
          1.005910E-2, 6.500655E-2, 2.899342E-2, 7.500756E-2, 1.799427E-2, 
          8.000806E-2, 4.355719E-3, 8.500857E-2, 1.690267E-2, 9.000907E-2, 
          1.026652E-2, 9.500958E-2, 2.398249E-2, 0.100010086, 7.791747E-3, 
          0.105010591, 1.520793E-2 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
  } // GIVEN
  */
} // TEST CASE
