#define CATCH_CONFIG_MAIN
#include <iostream>
#include "catch.hpp"
#include "coher/coher.h"
#include "generalTools/testing.h"
#include <range/v3/all.hpp>


TEST_CASE( "coher" ){

  int iel = 1, npr = 1, maxb = 60000;
  std::vector<double> b ( maxb, 0.0 );
  double emax = 5.0;
  std::vector<double> braggVals_0_to_99 (100);
  std::vector<double> braggVals_500_to_599 (100);

  GIVEN( "graphite is the requested material" ){
    iel = 1;
    WHEN( "1 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
	coher( iel, npr, maxb, b, emax );
	braggVals_0_to_99 = { 4.5558147E-4, 0.0000000000, 1.8223259E-3, 
          1.3693406E-2, 4.1002333E-3, 0.0000000000, 4.5158347E-3, 1.6310105E-3, 
          4.9714162E-3, 9.3268924E-3, 6.3381606E-3, 2.7534307E-3, 7.2893036E-3, 
          6.8467029E-3, 8.6160680E-3, 7.0847164E-3, 1.1389537E-2, 0.0000000000, 
          1.1805138E-2, 2.0175311E-3, 1.3547504E-2, 1.5066630E-2, 1.4003086E-2, 
          2.122138E-28, 1.5369830E-2, 2.8290539E-2, 1.5905372E-2, 5.2144093E-3, 
          1.6400933E-2, 4.5644686E-3, 1.7647737E-2, 1.890345E-28, 1.8063339E-2, 
          8.1550525E-4, 1.8518920E-2, 4.8324703E-3, 1.9885665E-2, 1.5544821E-3, 
          2.0836808E-2, 2.4297420E-2, 2.0916768E-2, 1.5156834E-3, 2.2163572E-2, 
          4.4173026E-3, 2.2323492E-2, 0.0000000000, 2.4937041E-2, 1.590241E-28, 
          2.5352642E-2, 1.3767154E-3, 2.6839327E-2, 4.0141280E-3, 2.9157214E-2, 
          3.4233515E-3, 2.9452876E-2, 3.8318912E-3, 2.9948437E-2, 2.0266963E-2, 
          3.1610843E-2, 1.2329281E-3, 3.2066424E-2, 7.3448301E-3, 3.3433169E-2, 
          2.3977119E-3, 3.3673049E-2, 1.1945781E-3, 3.4464272E-2, 1.1807861E-3, 
          3.5711076E-2, 6.9599409E-3, 3.5870996E-2, 1.325909E-28, 3.6902099E-2, 
          0.0000000000, 3.8900147E-2, 2.2228500E-3, 4.0386831E-2, 3.2723303E-3, 
          4.0642512E-2, 8.6987227E-3, 4.1098094E-2, 3.716174E-28, 4.1417934E-2, 
          3.2313411E-3, 4.2464838E-2, 1.7020057E-2, 4.2704718E-2, 1.6972188E-2, 
          4.3000380E-2, 6.3426519E-3, 4.4742746E-2, 3.561603E-28, 4.5558147E-2, 
          2.7386812E-3, 4.7220553E-2, 1.0087655E-3, 4.7931816E-2, 1.6020048E-2, 
          4.8011776E-2, 2.0008378E-3 };
        checkVec(b,braggVals_0_to_99,braggVals_0_to_99.size());
      } // THEN
    } // WHEN
    WHEN( "3 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
        npr = 3;
	coher( iel, npr, maxb, b, emax );
        braggVals_0_to_99 = { 4.5558147E-4, 0.0000000000, 1.8223259E-3, 
          4.5644686E-3, 4.1002333E-3, 0.0000000000, 4.5158347E-3, 5.4367017E-4, 
          4.9714162E-3, 3.1089641E-3, 6.3381606E-3, 9.1781024E-4, 7.2893036E-3, 
          2.2822343E-3, 8.6160680E-3, 2.3615721E-3, 1.1389537E-2, 0.0000000000, 
          1.1805138E-2, 6.7251036E-4, 1.3547504E-2, 5.0222099E-3, 1.4003086E-2, 
          7.073795E-29, 1.5369830E-2, 9.4301797E-3, 1.5905372E-2, 1.7381364E-3, 
          1.6400933E-2, 1.5214895E-3, 1.7647737E-2, 6.301150E-29, 1.8063339E-2, 
          2.7183508E-4, 1.8518920E-2, 1.6108234E-3, 1.9885665E-2, 5.1816069E-4, 
          2.0836808E-2, 8.0991400E-3, 2.0916768E-2, 5.0522779E-4, 2.2163572E-2, 
          1.4724342E-3, 2.2323492E-2, 0.0000000000, 2.4937041E-2, 5.300806E-29, 
          2.5352642E-2, 4.5890512E-4, 2.6839327E-2, 1.3380427E-3, 2.9157214E-2, 
          1.1411172E-3, 2.9452876E-2, 1.2772971E-3, 2.9948437E-2, 6.7556543E-3, 
          3.1610843E-2, 4.1097602E-4, 3.2066424E-2, 2.4482767E-3, 3.3433169E-2, 
          7.9923730E-4, 3.3673049E-2, 3.9819270E-4, 3.4464272E-2, 3.9359535E-4, 
          3.5711076E-2, 2.3199803E-3, 3.5870996E-2, 4.419698E-29, 3.6902099E-2, 
          0.0000000000, 3.8900147E-2, 7.4094999E-4, 4.0386831E-2, 1.0907768E-3, 
          4.0642512E-2, 2.8995742E-3, 4.1098094E-2, 1.238724E-28, 4.1417934E-2, 
          1.0771137E-3, 4.2464838E-2, 5.6733524E-3, 4.2704718E-2, 5.6573959E-3, 
          4.3000380E-2, 2.1142173E-3, 4.4742746E-2, 1.187201E-28, 4.5558147E-2, 
          9.1289372E-4, 4.7220553E-2, 3.3625518E-4, 4.7931816E-2, 5.3400160E-3, 
          4.8011776E-2, 6.6694593E-4 };
        checkVec(b,braggVals_0_to_99,braggVals_0_to_99.size());
      } // THEN
    } // WHEN
  } // GIVEN





  GIVEN( "beryllium metal is the requested material" ){
    iel = 2;
    WHEN( "1 principal scattering atom in compound" ){
      npr = 1;
      THEN( "bragg edges vector is correctly output" ){
        coher( iel, npr, maxb, b, emax );
        braggVals_0_to_99 = { 1.5928452E-3, 0.0000000000, 5.2198010E-3, 
          8.9780237E-3, 6.3713807E-3, 1.0835019E-2, 6.8126461E-3, 4.7152102E-2, 
          1.1591182E-2, 1.2049634E-2, 1.4335607E-2, 0.0000000000, 1.5659403E-2, 
          2.0733858E-2, 1.7252248E-2, 0.0000000000, 1.9555407E-2, 2.7830790E-2, 
          2.0879204E-2, 4.4890118E-3, 2.2030784E-2, 3.4960910E-2, 2.2472049E-2, 
          2.5961969E-2, 2.5485523E-2, 5.4175095E-3, 2.7250585E-2, 7.8586836E-3, 
          2.9995009E-2, 0.0000000000, 3.0705324E-2, 7.4033942E-3, 3.5214810E-2, 
          2.0739405E-2, 3.6538607E-2, 6.7867480E-3, 3.8131452E-2, 3.9860918E-2, 
          3.9821129E-2, 0.0000000000, 4.1144926E-2, 2.5582299E-2, 4.2909987E-2, 
          1.2525311E-2, 4.5040930E-2, 1.8338140E-2, 4.6364727E-2, 6.0248170E-3, 
          4.6978209E-2, 1.1970698E-2, 4.8571054E-2, 3.4509615E-2, 5.3349589E-2, 
          2.2466332E-2, 5.7342426E-2, 3.6116730E-3, 6.0700333E-2, 2.6214666E-2, 
          6.2562227E-2, 1.5553515E-2, 6.7857413E-2, 5.4269672E-2, 7.2463731E-2, 
          4.8005807E-2, 7.6359736E-2, 2.8168048E-2, 7.8049413E-2, 4.6384650E-3, 
          8.2193019E-2, 2.7150104E-2, 8.3269214E-2, 2.9071970E-2, 8.8123134E-2, 
          1.7480455E-2, 8.9888196E-2, 2.1287287E-2, 9.7852422E-2, 1.2441512E-2, 
          9.8928617E-2, 4.1013331E-2, 1.0194209E-1, 2.6761195E-2, 1.0716189E-1, 
          4.7286135E-2, 1.1351182E-1, 2.3103002E-2, 1.1458802E-1, 5.3467779E-2, 
          1.1760149E-1, 3.0112907E-2, 1.2282129E-1, 2.9464778E-2, 1.2902046E-1, 
          5.1362008E-2, 1.3686640E-1, 3.1356724E-2, 1.4085924E-1, 7.8135812E-2, 
          1.4892030E-1, 1.3446856E-2 };

        braggVals_500_to_599 = { 4.7065676E00, 1.6604899E-1, 4.7282533E00, 
          6.4950631E-1, 4.8183566E00, 1.3988329E00, 5.0000000000, 1.3988329E00, 
          5.1687479E19, 1.0430078E-6, 5.4286323E19, 2.1980656E-8, 5.4340330E19, 
          1.0335175E-6, 5.6853152E19, 1.1973872E-6, 5.9708819E19, 4.6588986E-9, 
          5.9715242E19, 3.8813193E-8, 5.9780690E19, 1.0862852E-8, 5.9824736E19, 
          9.3087658E-9, 5.9828462E19, 1.5514126E-9, 5.9830520E19, 6.2052733E-9, 
          5.9849224E19, 3.0237884E-8, 5.9931282E19, 9.2269901E-7, 6.2264810E19, 
          1.3321733E-6, 6.5388441E19, 2.3737156E-8, 6.5465932E19, 9.5279738E-7, 
          6.7922452E19, 1.4115651E-6, 7.1327857E19, 7.1035314E-9, 7.1362922E19, 
          5.1111418E-8, 7.1511669E19, 1.9153661E-8, 7.1549894E19, 1.0561234E-7, 
          7.1750377E19, 8.8028590E-7, 7.3826078E19, 1.4825885E-6, 7.7532303E19, 
          4.0884732E-9, 7.7534373E19, 2.7255794E-9, 7.7550167E19, 0.0000000000, 
          7.7554283E19, 4.0878938E-9, 7.7557406E19, 6.8128358E-9, 7.7575471E19, 
          9.5290865E-8, 7.7776996E19, 9.1111482E-7, 7.9975689E19, 1.6443680E-6, 
          8.3998954E19, 3.9279465E-9, 8.3999368E19, 1.9637110E-8, 8.4049599E19, 
          9.3266209E-7, 8.6371284E19, 1.8045704E-6, 9.0699910E19, 6.3001005E-9, 
          9.0704063E19, 1.0079690E-8, 9.0716807E19, 1.5117120E-8, 9.0767702E19, 
          3.2110741E-8, 9.0854905E19, 1.7479449E-7, 9.1273523E19, 6.8371463E-7, 
          9.3012864E19, 1.4725069E-6, 9.6519281E19, 1.4725069E-6, 0.0000000000, 
          0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 
          0.0000000000, 0.0000000000 ,0.00};
        checkPartOfVec(b,braggVals_0_to_99);
        checkPartOfVec(b,braggVals_500_to_599,500);
        restAreZero(600,b);


      } // THEN
    } // WHEN
  } // GIVEN





  GIVEN( "beryllium oxide is the requested material" ){
    iel = 3;
    WHEN( "1 principal scattering atom in compound" ){
      npr = 1;
      THEN( "bragg edges vector is correctly output" ){
        coher( iel, npr, maxb, b, emax );
        braggVals_0_to_99 = { 1.0611740E-3, 0.0000000000, 3.7543682E-3, 
          1.9057139E-2, 4.2446962E-3, 1.2191662E-2, 4.8155422E-3, 1.6539555E-2, 
          7.9990644E-3, 1.3321646E-2, 9.5505664E-3, 0.0000000000, 1.1263105E-2, 
          4.4010576E-2, 1.2324279E-2, 0.0000000000, 1.3304935E-2, 5.2025441E-2, 
          1.5017473E-2, 9.5285693E-3, 1.5507801E-2, 3.8270343E-2, 1.6078647E-2, 
          9.0515232E-3, 1.6978785E-2, 2.4321227E-4, 1.9262169E-2, 8.5846952E-3, 
          2.0733153E-2, 3.3013941E-4, 2.0813671E-2, 0.0000000000, 2.4568039E-2, 
          3.8285727E-2, 2.6280577E-2, 1.4405843E-2, 2.6529351E-2, 0.0000000000, 
          2.7341751E-2, 1.3882358E-2, 2.8241889E-2, 1.1314703E-3, 3.0283719E-2, 
          3.4483992E-2, 3.0525273E-2, 1.3638848E-2, 3.1996257E-2, 2.6575439E-4, 
          3.3789314E-2, 2.5409518E-2, 3.4850488E-2, 0.0000000000, 3.5831144E-2, 
          6.3404752E-2, 3.7792456E-2, 0.0000000000, 3.8034010E-2, 2.4437198E-2, 
          3.8202266E-2, 4.0638873E-3, 4.1546824E-2, 2.9441046E-2, 4.1956634E-2, 
          5.8167065E-3, 4.3259362E-2, 4.5710922E-4, 4.3339880E-2, 0.0000000000, 
          4.5052418E-2, 2.2005288E-2, 4.6113592E-2, 0.0000000000, 4.8806786E-2, 
          1.0570998E-2, 4.9297114E-2, 2.1464794E-2, 4.9465370E-2, 2.1428256E-2, 
          4.9867960E-2, 1.0279349E-2, 5.0768098E-2, 8.4390699E-4, 5.1997528E-2, 
          6.7737237E-2, 5.4602984E-2, 0.0000000000, 5.5751897E-2, 5.4543503E-2, 
          6.0069891E-2, 4.7642846E-3, 6.0318665E-2, 5.4055677E-3, 6.4314587E-2, 
          1.4452725E-2, 6.7015001E-2, 4.4336398E-3, 6.7915139E-2, 2.8717537E-2, 
          7.1332995E-2, 8.7440148E-3 };
        checkVec(b,braggVals_0_to_99,braggVals_0_to_99.size());
      } // THEN
    } // WHEN

    WHEN( "3 principal scattering atoms in compound" ){
      npr = 3;
      THEN( "bragg edges vector is correctly output" ){
        coher( iel, npr, maxb, b, emax );
        braggVals_0_to_99 = { 1.0611740E-3, 0.0000009000, 3.7543682E-3, 
          6.3523795E-3, 4.2446962E-3, 4.0638873E-3, 4.8155422E-3, 5.5131850E-3, 
          7.9990644E-3, 4.4405486E-3, 9.5505664E-3, 0.0000009000, 1.1263105E-2, 
          1.4670192E-2, 1.2324279E-2, 0.0000009000, 1.3304935E-2, 1.7341814E-2, 
          1.5017473E-2, 3.1761898E-3, 1.5507801E-2, 1.2756781E-2, 1.6078647E-2, 
          3.0171744E-3, 1.6978785E-2, 8.1070756E-5, 1.9262169E-2, 2.8615651E-3, 
          2.0733153E-2, 1.1004647E-4, 2.0813671E-2, 0.0000009000, 2.4568039E-2, 
          1.2761909E-2, 2.6280577E-2, 4.8019475E-3, 2.6529351E-2, 0.0000009000, 
          2.7341751E-2, 4.6274528E-3, 2.8241889E-2, 3.7715677E-4, 3.0283719E-2, 
          1.1494664E-2, 3.0525273E-2, 4.5462827E-3, 3.1996257E-2, 8.8584797E-5, 
          3.3789314E-2, 8.4698393E-3, 3.4850488E-2, 0.0000009000, 3.5831144E-2, 
          2.1134917E-2, 3.7792456E-2, 0.0000009000, 3.8034010E-2, 8.1457327E-3, 
          3.8202266E-2, 1.3546291E-3, 4.1546824E-2, 9.8136819E-3, 4.1956634E-2, 
          1.9389022E-3, 4.3259362E-2, 1.5236974E-4, 4.3339880E-2, 0.0000009000, 
          4.5052418E-2, 7.3350960E-3, 4.6113592E-2, 0.0000009000, 4.8806786E-2, 
          3.5236662E-3, 4.9297114E-2, 7.1549312E-3, 4.9465370E-2, 7.1427521E-3, 
          4.9867960E-2, 3.4264497E-3, 5.0768098E-2, 2.8130233E-4, 5.1997528E-2, 
          2.2579079E-2, 5.4602984E-2, 0.0000009000, 5.5751897E-2, 1.8181168E-2, 
          6.0069891E-2, 1.5880949E-3, 6.0318665E-2, 1.8018559E-3, 6.4314587E-2, 
          4.8175749E-3, 6.7015001E-2, 1.4778799E-3, 6.7915139E-2, 9.5725123E-3, 
          7.1332995E-2, 2.9146716E-3 };
        checkVec(b,braggVals_0_to_99,braggVals_0_to_99.size());
      } // THEN
    } // WHEN
  } // GIVEN








    /*

  GIVEN( "aluminum is the requested material" ){
    iel = 4;
    WHEN( "1 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 3.759017E-3, 5.508125E-3, 5.012023E-3, 
          3.577632E-3, 1.002404E-2, 5.059536E-3, 1.378306E-2, 8.629574E-3, 
          1.503607E-2, 2.754062E-3, 2.004809E-2, 1.788816E-3, 2.380711E-2, 
          6.566121E-3, 2.506011E-2, 6.399863E-3, 3.007214E-2, 5.842249E-3, 
          3.383116E-2, 7.344167E-3, 4.009619E-2, 2.529768E-3, 4.385520E-2, 
          9.675684E-3, 4.510821E-2, 5.962720E-3, 5.012023E-2, 4.525386E-3, 
          5.387925E-2, 4.364670E-3, 5.513226E-2, 4.314787E-3, 6.014428E-2, 
          1.377031E-3, 6.390330E-2, 8.015499E-3, 6.515631E-2, 3.969026E-3, 
          7.016833E-2, 7.649299E-3 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
    WHEN( "3 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
        npr = 3;
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 3.759017E-3, 1.836041E-3, 5.012023E-3, 
          1.192544E-3, 1.002404E-2, 1.686512E-3, 1.378306E-2, 2.876524E-3, 
          1.503607E-2, 9.180209E-4, 2.004809E-2, 5.962720E-4, 2.380711E-2, 
          2.188707E-3, 2.506011E-2, 2.133287E-3, 3.007214E-2, 1.947416E-3, 
          3.383116E-2, 2.448055E-3, 4.009619E-2, 8.432560E-4, 4.385520E-2, 
          3.225228E-3, 4.510821E-2, 1.987573E-3, 5.012023E-2, 1.508462E-3, 
          5.387925E-2, 1.454890E-3, 5.513226E-2, 1.438262E-3, 6.014428E-2, 
          4.590104E-4, 6.390330E-2, 2.671833E-3, 6.515631E-2, 1.323008E-3, 
          7.016833E-2, 2.549766E-3 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
  } // GIVEN



  GIVEN( "lead is the requested material" ){
    iel = 5;
    WHEN( "1 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 2.514103E-3, 2.464174E-3, 3.352138E-3, 
          1.600528E-3, 6.704277E-3, 2.263488E-3, 9.218381E-3, 3.860619E-3, 
          1.005641E-2, 1.232087E-3, 1.340855E-2, 8.002641E-4, 1.592265E-2, 
          2.937491E-3, 1.676069E-2, 2.863112E-3, 2.011283E-2, 2.613651E-3, 
          2.262693E-2, 3.285566E-3, 2.681710E-2, 1.131744E-3, 2.933121E-2, 
          4.328618E-3, 3.016924E-2, 2.667547E-3, 3.352138E-2, 2.024525E-3, 
          3.603549E-2, 1.952626E-3, 3.687352E-2, 1.930309E-3, 4.022566E-2, 
          6.160436E-4, 4.273976E-2, 3.585900E-3, 4.357780E-2, 1.775626E-3, 
          4.692994E-2, 3.422073E-3 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
    WHEN( "5 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
        npr = 5;
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 2.514103E-3, 4.928349E-4, 3.352138E-3, 
          3.201056E-4, 6.704277E-3, 4.526977E-4, 9.218381E-3, 7.721239E-4, 
          1.005641E-2, 2.464174E-4, 1.340855E-2, 1.600528E-4, 1.592265E-2, 
          5.874982E-4, 1.676069E-2, 5.726224E-4, 2.011283E-2, 5.227303E-4, 
          2.262693E-2, 6.571132E-4, 2.681710E-2, 2.263488E-4, 2.933121E-2, 
          8.657237E-4, 3.016924E-2, 5.335094E-4, 3.352138E-2, 4.049051E-4, 
          3.603549E-2, 3.905252E-4, 3.687352E-2, 3.860619E-4, 4.022566E-2, 
          1.232087E-4, 4.273976E-2, 7.171801E-4, 4.357780E-2, 3.551253E-4, 
          4.692994E-2, 6.844146E-4 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
  } // GIVEN

  GIVEN( "iron is the requested material" ){
    iel = 6;
    WHEN( "1 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 5.000504E-3, 8.711438E-2, 1.000100E-2, 
          3.079958E-2, 1.500151E-2, 0.100591032, 2.000201E-2, 4.355719E-2, 
          2.500252E-2, 7.791747E-2, 3.000302E-2, 2.370953E-2, 3.500353E-2, 
          0.131704577, 4.000403E-2, 1.539979E-2, 4.500453E-2, 8.711438E-2, 
          5.000504E-2, 5.509597E-2, 5.500554E-2, 5.253195E-2, 6.000605E-2, 
          5.029551E-2, 6.500655E-2, 0.144967107, 7.500756E-2, 8.997135E-2, 
          8.000806E-2, 2.177859E-2, 8.500857E-2, 8.451337E-2, 9.000907E-2, 
          5.133264E-2, 9.500958E-2, 0.119912469, 0.100010086, 3.895873E-2, 
          0.105010591, 7.603967E-2 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
    WHEN( "5 principal scattering atoms in compound" ){
      THEN( "bragg edges vector is correctly output" ){
        npr = 5;
	coher( iel, npr, maxb, b, emax );
        std::vector<double> bVals { 5.000504E-3, 1.742287E-2, 1.000100E-2, 
          6.159917E-3, 1.500151E-2, 2.011820E-2, 2.000201E-2, 8.711438E-3, 
          2.500252E-2, 1.558349E-2, 3.000302E-2, 4.741906E-3, 3.500353E-2, 
          2.634091E-2, 4.000403E-2, 3.079958E-3, 4.500453E-2, 1.742287E-2, 
          5.000504E-2, 1.101919E-2, 5.500554E-2, 1.050639E-2, 6.000605E-2, 
          1.005910E-2, 6.500655E-2, 2.899342E-2, 7.500756E-2, 1.799427E-2, 
          8.000806E-2, 4.355719E-3, 8.500857E-2, 1.690267E-2, 9.000907E-2, 
          1.026652E-2, 9.500958E-2, 2.398249E-2, 0.100010086, 7.791747E-3, 
          0.105010591, 1.520793E-2 };
        checkVec(b,bVals,bVals.size());
      } // THEN
    } // WHEN
  } // GIVEN
  */
} // TEST CASE
